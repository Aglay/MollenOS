; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.40629.0 

	TITLE	C:\Users\Philip\Documents\GitHub\MollenOS\clib\src\math\log10.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

_BSS	SEGMENT
_zero	DQ	01H DUP (?)
_BSS	ENDS
CONST	SEGMENT
_two54	DQ	04350000000000000r		; 1.80144e+016
_ivln10	DQ	03fdbcb7b1526e50er		; 0.434294
_log10_2hi DQ	03fd34413509f6000r		; 0.30103
_log10_2lo DQ	03d59fef311f12b36r		; 3.69424e-013
CONST	ENDS
PUBLIC	_log10
PUBLIC	__real@3d59fef311f12b36
PUBLIC	__real@3fd34413509f6000
PUBLIC	__real@3fdbcb7b1526e50e
PUBLIC	__real@4350000000000000
PUBLIC	__real@c350000000000000
EXTRN	__libm_sse2_log_precise:PROC
EXTRN	__fltused:DWORD
;	COMDAT __real@c350000000000000
CONST	SEGMENT
__real@c350000000000000 DQ 0c350000000000000r	; -1.80144e+016
CONST	ENDS
;	COMDAT __real@4350000000000000
CONST	SEGMENT
__real@4350000000000000 DQ 04350000000000000r	; 1.80144e+016
CONST	ENDS
;	COMDAT __real@3fdbcb7b1526e50e
CONST	SEGMENT
__real@3fdbcb7b1526e50e DQ 03fdbcb7b1526e50er	; 0.434294
CONST	ENDS
;	COMDAT __real@3fd34413509f6000
CONST	SEGMENT
__real@3fd34413509f6000 DQ 03fd34413509f6000r	; 0.30103
CONST	ENDS
;	COMDAT __real@3d59fef311f12b36
CONST	SEGMENT
__real@3d59fef311f12b36 DQ 03d59fef311f12b36r	; 3.69424e-013
CONST	ENDS
; Function compile flags: /Ogtp
; File c:\users\philip\documents\github\mollenos\clib\src\math\log10.c
;	COMDAT _log10
_TEXT	SEGMENT
tv211 = 8						; size = 8
_x$ = 8							; size = 8
_log10	PROC						; COMDAT

; 62   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 63   : 	double y,z;
; 64   : 	int i,k,hx;
; 65   : 	unsigned lx;
; 66   : 
; 67   : 	hx = __HI(x);	/* high word of x */
; 68   : 	lx = __LO(x);	/* low word of x */
; 69   : 
; 70   :         k=0;
; 71   :         if (hx < 0x00100000) {                  /* x < 2**-1022  */

  00003	8b 55 0c	 mov	 edx, DWORD PTR _x$[ebp+4]
  00006	33 c9		 xor	 ecx, ecx
  00008	81 fa 00 00 10
	00		 cmp	 edx, 1048576		; 00100000H
  0000e	7d 45		 jge	 SHORT $LN4@log10

; 72   :             if (((hx&0x7fffffff)|lx)==0)

  00010	8b c2		 mov	 eax, edx
  00012	25 ff ff ff 7f	 and	 eax, 2147483647		; 7fffffffH
  00017	0b 45 08	 or	 eax, DWORD PTR _x$[ebp]
  0001a	75 0e		 jne	 SHORT $LN3@log10

; 73   :                 return -two54/zero;             /* log(+-0)=-inf */

  0001c	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@c350000000000000
  00022	dc 35 00 00 00
	00		 fdiv	 QWORD PTR _zero

; 86   : }

  00028	5d		 pop	 ebp
  00029	c3		 ret	 0
$LN3@log10:

; 74   :             if (hx<0) return (x-x)/zero;        /* log(-#) = NaN */

  0002a	85 d2		 test	 edx, edx
  0002c	79 0d		 jns	 SHORT $LN2@log10
  0002e	dd 45 08	 fld	 QWORD PTR _x$[ebp]
  00031	dc e8		 fsub	 ST(0), ST(0)
  00033	dc 35 00 00 00
	00		 fdiv	 QWORD PTR _zero

; 86   : }

  00039	5d		 pop	 ebp
  0003a	c3		 ret	 0
$LN2@log10:

; 75   :             k -= 54; x *= two54; /* subnormal number, scale up x */

  0003b	f2 0f 10 45 08	 movsd	 xmm0, QWORD PTR _x$[ebp]
  00040	b9 ca ff ff ff	 mov	 ecx, -54		; ffffffcaH
  00045	f2 0f 59 05 00
	00 00 00	 mulsd	 xmm0, QWORD PTR __real@4350000000000000
  0004d	f2 0f 11 45 08	 movsd	 QWORD PTR _x$[ebp], xmm0
  00052	8b 55 0c	 mov	 edx, DWORD PTR _x$[ebp+4]
$LN4@log10:

; 76   :             hx = __HI(x);                /* high word of x */
; 77   :         }
; 78   : 	if (hx >= 0x7ff00000) return x+x;

  00055	81 fa 00 00 f0
	7f		 cmp	 edx, 2146435072		; 7ff00000H
  0005b	7c 07		 jl	 SHORT $LN1@log10
  0005d	dd 45 08	 fld	 QWORD PTR _x$[ebp]
  00060	dc c0		 fadd	 ST(0), ST(0)

; 86   : }

  00062	5d		 pop	 ebp
  00063	c3		 ret	 0
$LN1@log10:

; 79   : 	k += (hx>>20)-1023;

  00064	8b c2		 mov	 eax, edx
  00066	81 c1 01 fc ff
	ff		 add	 ecx, -1023		; fffffc01H
  0006c	c1 f8 14	 sar	 eax, 20			; 00000014H

; 80   : 	i  = ((unsigned)k&0x80000000)>>31;
; 81   :         hx = (hx&0x000fffff)|((0x3ff-i)<<20);

  0006f	81 e2 ff ff 0f
	00		 and	 edx, 1048575		; 000fffffH
  00075	03 c1		 add	 eax, ecx
  00077	8b c8		 mov	 ecx, eax
  00079	c1 e9 1f	 shr	 ecx, 31			; 0000001fH
  0007c	56		 push	 esi

; 82   :         y  = (double)(k+i);

  0007d	8d 34 01	 lea	 esi, DWORD PTR [ecx+eax]

; 83   :         __HI(x) = hx;

  00080	b8 ff 03 00 00	 mov	 eax, 1023		; 000003ffH
  00085	2b c1		 sub	 eax, ecx
  00087	c1 e0 14	 shl	 eax, 20			; 00000014H
  0008a	0b c2		 or	 eax, edx
  0008c	89 45 0c	 mov	 DWORD PTR _x$[ebp+4], eax

; 84   : 	z  = y*log10_2lo + ivln10*log(x);

  0008f	f2 0f 10 45 08	 movsd	 xmm0, QWORD PTR _x$[ebp]
  00094	e8 00 00 00 00	 call	 __libm_sse2_log_precise
  00099	f2 0f 59 05 00
	00 00 00	 mulsd	 xmm0, QWORD PTR __real@3fdbcb7b1526e50e
  000a1	66 0f 6e d6	 movd	 xmm2, esi
  000a5	f3 0f e6 d2	 cvtdq2pd xmm2, xmm2
  000a9	5e		 pop	 esi
  000aa	66 0f 28 ca	 movapd	 xmm1, xmm2

; 85   : 	return  z+y*log10_2hi;

  000ae	f2 0f 59 15 00
	00 00 00	 mulsd	 xmm2, QWORD PTR __real@3fd34413509f6000
  000b6	f2 0f 59 0d 00
	00 00 00	 mulsd	 xmm1, QWORD PTR __real@3d59fef311f12b36
  000be	f2 0f 58 c1	 addsd	 xmm0, xmm1
  000c2	f2 0f 58 c2	 addsd	 xmm0, xmm2
  000c6	f2 0f 11 45 08	 movsd	 QWORD PTR tv211[ebp], xmm0
  000cb	dd 45 08	 fld	 QWORD PTR tv211[ebp]

; 86   : }

  000ce	5d		 pop	 ebp
  000cf	c3		 ret	 0
_log10	ENDP
_TEXT	ENDS
END
