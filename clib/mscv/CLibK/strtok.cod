; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.40629.0 

	TITLE	C:\Users\Philip\Documents\GitHub\MollenOS\clib\src\string\strtok.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	_strtok_r
PUBLIC	_strtok
PUBLIC	??_C@_00CNPNBAHC@?$AA@				; `string'
EXTRN	_TLSGetCurrent:PROC
EXTRN	_strcspn:PROC
EXTRN	_strspn:PROC
;	COMDAT ??_C@_00CNPNBAHC@?$AA@
CONST	SEGMENT
??_C@_00CNPNBAHC@?$AA@ DB 00H				; `string'
CONST	ENDS
; Function compile flags: /Ogtp
; File c:\users\philip\documents\github\mollenos\clib\src\string\strtok.c
;	COMDAT _strtok
_TEXT	SEGMENT
_str$ = 8						; size = 4
_delimiters$ = 12					; size = 4
_strtok	PROC						; COMDAT

; 52   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 53   : 	/* Call with the pointer in TLS 
; 54   : 	 * so strktok is thread specific */
; 55   : 	return strtok_r(str, delimiters, &TLSGetCurrent()->StrTokNext);

  00003	e8 00 00 00 00	 call	 _TLSGetCurrent
  00008	83 c0 18	 add	 eax, 24			; 00000018H
  0000b	50		 push	 eax
  0000c	ff 75 0c	 push	 DWORD PTR _delimiters$[ebp]
  0000f	ff 75 08	 push	 DWORD PTR _str$[ebp]
  00012	e8 00 00 00 00	 call	 _strtok_r
  00017	83 c4 0c	 add	 esp, 12			; 0000000cH

; 56   : }

  0001a	5d		 pop	 ebp
  0001b	c3		 ret	 0
_strtok	ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File c:\users\philip\documents\github\mollenos\clib\src\string\strtok.c
;	COMDAT _strtok_r
_TEXT	SEGMENT
_s$ = 8							; size = 4
_delimiters$ = 12					; size = 4
_lasts$ = 16						; size = 4
_strtok_r PROC						; COMDAT

; 35   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	56		 push	 esi

; 36   : 	char *sbegin, *send;
; 37   :      sbegin = s ? s : *lasts;

  00004	8b 75 08	 mov	 esi, DWORD PTR _s$[ebp]
  00007	57		 push	 edi
  00008	8b 7d 10	 mov	 edi, DWORD PTR _lasts$[ebp]
  0000b	85 f6		 test	 esi, esi
  0000d	75 02		 jne	 SHORT $LN6@strtok_r
  0000f	8b 37		 mov	 esi, DWORD PTR [edi]
$LN6@strtok_r:

; 38   :      sbegin += strspn(sbegin, delimiters);

  00011	ff 75 0c	 push	 DWORD PTR _delimiters$[ebp]
  00014	56		 push	 esi
  00015	e8 00 00 00 00	 call	 _strspn
  0001a	03 f0		 add	 esi, eax
  0001c	83 c4 08	 add	 esp, 8

; 39   :      if (*sbegin == '\0') {

  0001f	80 3e 00	 cmp	 BYTE PTR [esi], 0
  00022	75 0c		 jne	 SHORT $LN2@strtok_r

; 40   :          *lasts = "";

  00024	c7 07 00 00 00
	00		 mov	 DWORD PTR [edi], OFFSET ??_C@_00CNPNBAHC@?$AA@

; 41   :          return NULL;

  0002a	33 c0		 xor	 eax, eax
  0002c	5f		 pop	 edi
  0002d	5e		 pop	 esi

; 48   : }

  0002e	5d		 pop	 ebp
  0002f	c3		 ret	 0
$LN2@strtok_r:

; 42   :      }
; 43   :      send = sbegin + strcspn(sbegin, delimiters);

  00030	ff 75 0c	 push	 DWORD PTR _delimiters$[ebp]
  00033	56		 push	 esi
  00034	e8 00 00 00 00	 call	 _strcspn
  00039	03 c6		 add	 eax, esi
  0003b	83 c4 08	 add	 esp, 8

; 44   :      if (*send != '\0')

  0003e	80 38 00	 cmp	 BYTE PTR [eax], 0
  00041	74 04		 je	 SHORT $LN1@strtok_r

; 45   :          *send++ = '\0';

  00043	c6 00 00	 mov	 BYTE PTR [eax], 0
  00046	40		 inc	 eax
$LN1@strtok_r:

; 46   :      *lasts = send;

  00047	89 07		 mov	 DWORD PTR [edi], eax

; 47   :      return sbegin;

  00049	8b c6		 mov	 eax, esi
  0004b	5f		 pop	 edi
  0004c	5e		 pop	 esi

; 48   : }

  0004d	5d		 pop	 ebp
  0004e	c3		 ret	 0
_strtok_r ENDP
_TEXT	ENDS
END
