; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.40629.0 

	TITLE	C:\Users\Philip\Documents\GitHub\MollenOS\clib\src\math\log.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

_BSS	SEGMENT
_zero	DQ	01H DUP (?)
_BSS	ENDS
CONST	SEGMENT
_ln2_hi	DQ	03fe62e42fee00000r		; 0.693147
_ln2_lo	DQ	03dea39ef35793c76r		; 1.90821e-010
_two54	DQ	04350000000000000r		; 1.80144e+016
_Lg1	DQ	03fe5555555555593r		; 0.666667
_Lg2	DQ	03fd999999997fa04r		; 0.4
_Lg3	DQ	03fd2492494229359r		; 0.285714
_Lg4	DQ	03fcc71c51d8e78afr		; 0.222222
_Lg5	DQ	03fc7466496cb03der		; 0.181836
_Lg6	DQ	03fc39a09d078c69fr		; 0.153138
_Lg7	DQ	03fc2f112df3e5244r		; 0.147982
CONST	ENDS
PUBLIC	_log
PUBLIC	__real@3dea39ef35793c76
PUBLIC	__real@3fc2f112df3e5244
PUBLIC	__real@3fc39a09d078c69f
PUBLIC	__real@3fc7466496cb03de
PUBLIC	__real@3fcc71c51d8e78af
PUBLIC	__real@3fd2492494229359
PUBLIC	__real@3fd5555555555555
PUBLIC	__real@3fd999999997fa04
PUBLIC	__real@3fe0000000000000
PUBLIC	__real@3fe5555555555593
PUBLIC	__real@3fe62e42fee00000
PUBLIC	__real@3ff0000000000000
PUBLIC	__real@4000000000000000
PUBLIC	__real@4350000000000000
PUBLIC	__real@c350000000000000
EXTRN	__fltused:DWORD
;	COMDAT __real@c350000000000000
CONST	SEGMENT
__real@c350000000000000 DQ 0c350000000000000r	; -1.80144e+016
CONST	ENDS
;	COMDAT __real@4350000000000000
CONST	SEGMENT
__real@4350000000000000 DQ 04350000000000000r	; 1.80144e+016
CONST	ENDS
;	COMDAT __real@4000000000000000
CONST	SEGMENT
__real@4000000000000000 DQ 04000000000000000r	; 2
CONST	ENDS
;	COMDAT __real@3ff0000000000000
CONST	SEGMENT
__real@3ff0000000000000 DQ 03ff0000000000000r	; 1
CONST	ENDS
;	COMDAT __real@3fe62e42fee00000
CONST	SEGMENT
__real@3fe62e42fee00000 DQ 03fe62e42fee00000r	; 0.693147
CONST	ENDS
;	COMDAT __real@3fe5555555555593
CONST	SEGMENT
__real@3fe5555555555593 DQ 03fe5555555555593r	; 0.666667
CONST	ENDS
;	COMDAT __real@3fe0000000000000
CONST	SEGMENT
__real@3fe0000000000000 DQ 03fe0000000000000r	; 0.5
CONST	ENDS
;	COMDAT __real@3fd999999997fa04
CONST	SEGMENT
__real@3fd999999997fa04 DQ 03fd999999997fa04r	; 0.4
CONST	ENDS
;	COMDAT __real@3fd5555555555555
CONST	SEGMENT
__real@3fd5555555555555 DQ 03fd5555555555555r	; 0.333333
CONST	ENDS
;	COMDAT __real@3fd2492494229359
CONST	SEGMENT
__real@3fd2492494229359 DQ 03fd2492494229359r	; 0.285714
CONST	ENDS
;	COMDAT __real@3fcc71c51d8e78af
CONST	SEGMENT
__real@3fcc71c51d8e78af DQ 03fcc71c51d8e78afr	; 0.222222
CONST	ENDS
;	COMDAT __real@3fc7466496cb03de
CONST	SEGMENT
__real@3fc7466496cb03de DQ 03fc7466496cb03der	; 0.181836
CONST	ENDS
;	COMDAT __real@3fc39a09d078c69f
CONST	SEGMENT
__real@3fc39a09d078c69f DQ 03fc39a09d078c69fr	; 0.153138
CONST	ENDS
;	COMDAT __real@3fc2f112df3e5244
CONST	SEGMENT
__real@3fc2f112df3e5244 DQ 03fc2f112df3e5244r	; 0.147982
CONST	ENDS
;	COMDAT __real@3dea39ef35793c76
CONST	SEGMENT
__real@3dea39ef35793c76 DQ 03dea39ef35793c76r	; 1.90821e-010
CONST	ENDS
; Function compile flags: /Ogtp
; File c:\users\philip\documents\github\mollenos\clib\src\math\log.c
;	COMDAT _log
_TEXT	SEGMENT
_k$ = -4						; size = 4
_x$ = 8							; size = 8
_log	PROC						; COMDAT

; 85   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx

; 86   : 	double hfsq,f,s,z,R,w,t1,t2,dk;
; 87   : 	int k,hx,i,j;
; 88   : 	unsigned lx;
; 89   : 
; 90   : 	hx = __HI(x);		/* high word of x */
; 91   : 	lx = __LO(x);		/* low  word of x */
; 92   : 
; 93   : 	k=0;
; 94   : 	if (hx < 0x00100000) {			/* x < 2**-1022  */

  00004	8b 55 0c	 mov	 edx, DWORD PTR _x$[ebp+4]
  00007	33 c9		 xor	 ecx, ecx
  00009	81 fa 00 00 10
	00		 cmp	 edx, 1048576		; 00100000H
  0000f	7d 42		 jge	 SHORT $LN19@log

; 95   : 	    if (((hx&0x7fffffff)|lx)==0) 

  00011	8b c2		 mov	 eax, edx
  00013	25 ff ff ff 7f	 and	 eax, 2147483647		; 7fffffffH
  00018	0b 45 08	 or	 eax, DWORD PTR _x$[ebp]
  0001b	75 10		 jne	 SHORT $LN15@log

; 96   : 		return -two54/zero;		/* log(+-0)=-inf */

  0001d	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@c350000000000000
  00023	dc 35 00 00 00
	00		 fdiv	 QWORD PTR _zero

; 132  : 	}
; 133  : }

  00029	8b e5		 mov	 esp, ebp
  0002b	5d		 pop	 ebp
  0002c	c3		 ret	 0
$LN15@log:

; 97   : 	    if (hx<0) return (x-x)/zero;	/* log(-#) = NaN */

  0002d	dd 45 08	 fld	 QWORD PTR _x$[ebp]
  00030	85 d2		 test	 edx, edx
  00032	79 0c		 jns	 SHORT $LN14@log
  00034	dc e8		 fsub	 ST(0), ST(0)
  00036	dc 35 00 00 00
	00		 fdiv	 QWORD PTR _zero

; 132  : 	}
; 133  : }

  0003c	8b e5		 mov	 esp, ebp
  0003e	5d		 pop	 ebp
  0003f	c3		 ret	 0
$LN14@log:

; 98   : 	    k -= 54; x *= two54; /* subnormal number, scale up x */

  00040	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@4350000000000000
  00046	b9 ca ff ff ff	 mov	 ecx, -54		; ffffffcaH
  0004b	dd 55 08	 fst	 QWORD PTR _x$[ebp]
  0004e	8b 55 0c	 mov	 edx, DWORD PTR _x$[ebp+4]
  00051	eb 03		 jmp	 SHORT $LN16@log
$LN19@log:
  00053	dd 45 08	 fld	 QWORD PTR _x$[ebp]
$LN16@log:

; 99   : 	    hx = __HI(x);		/* high word of x */
; 100  : 	} 
; 101  : 	if (hx >= 0x7ff00000) return x+x;

  00056	81 fa 00 00 f0
	7f		 cmp	 edx, 2146435072		; 7ff00000H
  0005c	7c 06		 jl	 SHORT $LN23@log
  0005e	dc c0		 fadd	 ST(0), ST(0)

; 132  : 	}
; 133  : }

  00060	8b e5		 mov	 esp, ebp
  00062	5d		 pop	 ebp
  00063	c3		 ret	 0
$LN23@log:
  00064	56		 push	 esi

; 102  : 	k += (hx>>20)-1023;

  00065	8b f2		 mov	 esi, edx
  00067	81 c1 01 fc ff
	ff		 add	 ecx, -1023		; fffffc01H

; 103  : 	hx &= 0x000fffff;

  0006d	81 e2 ff ff 0f
	00		 and	 edx, 1048575		; 000fffffH
  00073	c1 fe 14	 sar	 esi, 20			; 00000014H
  00076	03 f1		 add	 esi, ecx
  00078	dd d8		 fstp	 ST(0)

; 104  : 	i = (hx+0x95f64)&0x100000;

  0007a	8d 8a 64 5f 09
	00		 lea	 ecx, DWORD PTR [edx+614244]
  00080	81 e1 00 00 10
	00		 and	 ecx, 1048576		; 00100000H

; 105  : 	__HI(x) = hx|(i^0x3ff00000);	/* normalize x or x/2 */

  00086	8b c1		 mov	 eax, ecx

; 106  : 	k += (i>>20);

  00088	c1 f9 14	 sar	 ecx, 20			; 00000014H
  0008b	35 00 00 f0 3f	 xor	 eax, 1072693248		; 3ff00000H
  00090	03 f1		 add	 esi, ecx
  00092	0b c2		 or	 eax, edx
  00094	89 75 fc	 mov	 DWORD PTR _k$[ebp], esi
  00097	89 45 0c	 mov	 DWORD PTR _x$[ebp+4], eax

; 107  : 	f = x-1.0;
; 108  : 	if((0x000fffff&(2+hx))<3) {	/* |f| < 2**-20 */

  0009a	8d 42 02	 lea	 eax, DWORD PTR [edx+2]
  0009d	dd 45 08	 fld	 QWORD PTR _x$[ebp]
  000a0	25 ff ff 0f 00	 and	 eax, 1048575		; 000fffffH
  000a5	dc 25 00 00 00
	00		 fsub	 QWORD PTR __real@3ff0000000000000
  000ab	83 f8 03	 cmp	 eax, 3
  000ae	7d 64		 jge	 SHORT $LN7@log

; 109  : 	    if(f==zero) if(k==0) return zero;  else {dk=(double)k;

  000b0	dd 05 00 00 00
	00		 fld	 QWORD PTR _zero
  000b6	d9 c9		 fxch	 ST(1)
  000b8	db e9		 fucomi	 ST(1)
  000ba	9f		 lahf
  000bb	f6 c4 44	 test	 ah, 68			; 00000044H
  000be	7a 26		 jp	 SHORT $LN29@log
  000c0	dd d8		 fstp	 ST(0)
  000c2	85 f6		 test	 esi, esi
  000c4	0f 84 21 01 00
	00		 je	 $LN20@log
  000ca	dd d8		 fstp	 ST(0)
  000cc	db 45 fc	 fild	 DWORD PTR _k$[ebp]
  000cf	5e		 pop	 esi

; 110  : 				 return dk*ln2_hi+dk*ln2_lo;}

  000d0	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@3dea39ef35793c76
  000d6	d8 c9		 fmul	 ST(0), ST(1)
  000d8	d9 c9		 fxch	 ST(1)
  000da	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@3fe62e42fee00000
  000e0	de c1		 faddp	 ST(1), ST(0)

; 132  : 	}
; 133  : }

  000e2	8b e5		 mov	 esp, ebp
  000e4	5d		 pop	 ebp
  000e5	c3		 ret	 0
$LN29@log:
  000e6	dd d9		 fstp	 ST(1)

; 111  : 	    R = f*f*(0.5-0.33333333333333333*f);

  000e8	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@3fd5555555555555
  000ee	d8 c9		 fmul	 ST(0), ST(1)
  000f0	dc 2d 00 00 00
	00		 fsubr	 QWORD PTR __real@3fe0000000000000
  000f6	d9 c1		 fld	 ST(1)
  000f8	d8 ca		 fmul	 ST(0), ST(2)
  000fa	de c9		 fmulp	 ST(1), ST(0)

; 112  : 	    if(k==0) return f-R; else {dk=(double)k;

  000fc	85 f6		 test	 esi, esi
  000fe	0f 84 c0 00 00
	00		 je	 $LN48@log
  00104	db 45 fc	 fild	 DWORD PTR _k$[ebp]

; 113  : 	    	     return dk*ln2_hi-((R-dk*ln2_lo)-f);}

  00107	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@3fe62e42fee00000
  0010d	d8 c9		 fmul	 ST(0), ST(1)
  0010f	e9 c7 00 00 00	 jmp	 $LN46@log
$LN7@log:

; 114  : 	}
; 115  :  	s = f/(2.0+f); 

  00114	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@4000000000000000

; 116  : 	dk = (double)k;
; 117  : 	z = s*s;
; 118  : 	i = hx-0x6147a;

  0011a	8d 82 86 eb f9
	ff		 lea	 eax, DWORD PTR [edx-398458]
  00120	d8 c1		 fadd	 ST(0), ST(1)

; 119  : 	w = z*z;
; 120  : 	j = 0x6b851-hx;

  00122	b9 51 b8 06 00	 mov	 ecx, 440401		; 0006b851H
  00127	2b ca		 sub	 ecx, edx

; 121  : 	t1= w*(Lg2+w*(Lg4+w*Lg6)); 
; 122  : 	t2= z*(Lg1+w*(Lg3+w*(Lg5+w*Lg7))); 
; 123  : 	i |= j;

  00129	0b c8		 or	 ecx, eax
  0012b	d8 f9		 fdivr	 ST(0), ST(1)
  0012d	db 45 fc	 fild	 DWORD PTR _k$[ebp]
  00130	d9 c1		 fld	 ST(1)
  00132	d8 ca		 fmul	 ST(0), ST(2)
  00134	d9 c0		 fld	 ST(0)
  00136	d8 c9		 fmul	 ST(0), ST(1)
  00138	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@3fc2f112df3e5244
  0013e	d8 c9		 fmul	 ST(0), ST(1)
  00140	dc 05 00 00 00
	00		 fadd	 QWORD PTR __real@3fc7466496cb03de
  00146	d8 c9		 fmul	 ST(0), ST(1)
  00148	dc 05 00 00 00
	00		 fadd	 QWORD PTR __real@3fd2492494229359
  0014e	d8 c9		 fmul	 ST(0), ST(1)
  00150	dc 05 00 00 00
	00		 fadd	 QWORD PTR __real@3fe5555555555593
  00156	de ca		 fmulp	 ST(2), ST(0)
  00158	dd 05 00 00 00
	00		 fld	 QWORD PTR __real@3fc39a09d078c69f
  0015e	d8 c9		 fmul	 ST(0), ST(1)
  00160	dc 05 00 00 00
	00		 fadd	 QWORD PTR __real@3fcc71c51d8e78af
  00166	d8 c9		 fmul	 ST(0), ST(1)
  00168	dc 05 00 00 00
	00		 fadd	 QWORD PTR __real@3fd999999997fa04
  0016e	de c9		 fmulp	 ST(1), ST(0)

; 124  : 	R = t2+t1;

  00170	de c1		 faddp	 ST(1), ST(0)

; 125  : 	if(i>0) {

  00172	7e 46		 jle	 SHORT $LN6@log

; 126  : 	    hfsq=0.5*f*f;

  00174	d9 c3		 fld	 ST(3)
  00176	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@3fe0000000000000
  0017c	d8 cc		 fmul	 ST(0), ST(4)

; 127  : 	    if(k==0) return f-(hfsq-s*(hfsq+R)); else

  0017e	85 f6		 test	 esi, esi
  00180	75 0f		 jne	 SHORT $LN5@log
  00182	dd da		 fstp	 ST(2)
  00184	d8 c1		 fadd	 ST(0), ST(1)
  00186	5e		 pop	 esi
  00187	de ca		 fmulp	 ST(2), ST(0)
  00189	de e1		 fsubrp	 ST(1), ST(0)
  0018b	de e9		 fsubp	 ST(1), ST(0)

; 132  : 	}
; 133  : }

  0018d	8b e5		 mov	 esp, ebp
  0018f	5d		 pop	 ebp
  00190	c3		 ret	 0
$LN5@log:

; 128  : 		     return dk*ln2_hi-((hfsq-(s*(hfsq+R)+dk*ln2_lo))-f);

  00191	d9 c2		 fld	 ST(2)
  00193	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@3fe62e42fee00000
  00199	d9 c1		 fld	 ST(1)
  0019b	de c3		 faddp	 ST(3), ST(0)
  0019d	d9 ca		 fxch	 ST(2)
  0019f	5e		 pop	 esi
  001a0	de cc		 fmulp	 ST(4), ST(0)
  001a2	d9 ca		 fxch	 ST(2)
  001a4	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@3dea39ef35793c76
  001aa	de c3		 faddp	 ST(3), ST(0)
  001ac	d9 c9		 fxch	 ST(1)
  001ae	de e2		 fsubrp	 ST(2), ST(0)

; 131  : 		     return dk*ln2_hi-((s*(f-R)-dk*ln2_lo)-f);

  001b0	d9 c9		 fxch	 ST(1)
  001b2	de e2		 fsubrp	 ST(2), ST(0)
  001b4	de e1		 fsubrp	 ST(1), ST(0)

; 132  : 	}
; 133  : }

  001b6	8b e5		 mov	 esp, ebp
  001b8	5d		 pop	 ebp
  001b9	c3		 ret	 0
$LN6@log:

; 129  : 	} else {
; 130  : 	    if(k==0) return f-s*(f-R); else

  001ba	85 f6		 test	 esi, esi
  001bc	75 0d		 jne	 SHORT $LN2@log
  001be	dd d9		 fstp	 ST(1)
  001c0	d8 ea		 fsubr	 ST(0), ST(2)
  001c2	de c9		 fmulp	 ST(1), ST(0)
$LN48@log:
  001c4	de e9		 fsubp	 ST(1), ST(0)
  001c6	5e		 pop	 esi

; 132  : 	}
; 133  : }

  001c7	8b e5		 mov	 esp, ebp
  001c9	5d		 pop	 ebp
  001ca	c3		 ret	 0
$LN2@log:

; 131  : 		     return dk*ln2_hi-((s*(f-R)-dk*ln2_lo)-f);

  001cb	d9 c1		 fld	 ST(1)
  001cd	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@3fe62e42fee00000
  001d3	d9 c4		 fld	 ST(4)
  001d5	de e2		 fsubrp	 ST(2), ST(0)
  001d7	d9 c9		 fxch	 ST(1)
  001d9	de cb		 fmulp	 ST(3), ST(0)
$LN46@log:
  001db	d9 c9		 fxch	 ST(1)
  001dd	dc 0d 00 00 00
	00		 fmul	 QWORD PTR __real@3dea39ef35793c76
  001e3	de ea		 fsubp	 ST(2), ST(0)
  001e5	d9 c9		 fxch	 ST(1)
  001e7	de e2		 fsubrp	 ST(2), ST(0)
  001e9	de e1		 fsubrp	 ST(1), ST(0)
$LN20@log:
  001eb	5e		 pop	 esi

; 132  : 	}
; 133  : }

  001ec	8b e5		 mov	 esp, ebp
  001ee	5d		 pop	 ebp
  001ef	c3		 ret	 0
_log	ENDP
_TEXT	ENDS
END
