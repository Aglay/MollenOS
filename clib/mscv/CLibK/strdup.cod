; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.31101.0 

	TITLE	C:\Users\Philip\Documents\GitHub\MollenOS\clib\src\string\strdup.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	_strdup
EXTRN	_kmalloc:PROC
EXTRN	_memcpy:PROC
; Function compile flags: /Ogtp
; File c:\users\philip\documents\github\mollenos\clib\src\string\strdup.c
;	COMDAT _strdup
_TEXT	SEGMENT
_str$ = 8						; size = 4
_strdup	PROC						; COMDAT

; 11   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 12   : 	size_t len = strlen(str);

  00003	8b 45 08	 mov	 eax, DWORD PTR _str$[ebp]
  00006	8d 50 01	 lea	 edx, DWORD PTR [eax+1]
  00009	8d a4 24 00 00
	00 00		 npad	 7
$LL3@strdup:
  00010	8a 08		 mov	 cl, BYTE PTR [eax]
  00012	40		 inc	 eax
  00013	84 c9		 test	 cl, cl
  00015	75 f9		 jne	 SHORT $LL3@strdup
  00017	2b c2		 sub	 eax, edx
  00019	56		 push	 esi
  0001a	57		 push	 edi

; 13   : 	char * out = (char*)kmalloc(sizeof(char) * (len+1));

  0001b	8d 70 01	 lea	 esi, DWORD PTR [eax+1]
  0001e	56		 push	 esi
  0001f	e8 00 00 00 00	 call	 _kmalloc

; 14   : 
; 15   : 	memcpy(out, str, len+1);

  00024	56		 push	 esi
  00025	ff 75 08	 push	 DWORD PTR _str$[ebp]
  00028	8b f8		 mov	 edi, eax
  0002a	57		 push	 edi
  0002b	e8 00 00 00 00	 call	 _memcpy
  00030	83 c4 10	 add	 esp, 16			; 00000010H

; 16   : 
; 17   : 	return out;

  00033	8b c7		 mov	 eax, edi
  00035	5f		 pop	 edi
  00036	5e		 pop	 esi

; 18   : }

  00037	5d		 pop	 ebp
  00038	c3		 ret	 0
_strdup	ENDP
_TEXT	ENDS
END
